LightboxOptions=Object.extend({fileBase:"",fileLoadingImage:"http://service.internet-baukasten.de/centraljs/lightbox2/images/loading.gif",fileBottomNavCloseImage:"http://service.internet-baukasten.de/centraljs/lightbox2/images/close.gif",overlayOpacity:0.8,animate:true,resizeSpeed:7,borderSize:10,activateHoverNav:false,circulateImages:true,imageResize:false,rlDistance:20,tbDistance:10,imageDataContainerHeight:30,imageScroll:false,imageScrollHoricontal:false,imageScrollVertical:false,imageScrollDelay:100,showResizeFactor:true,labelImage:"Bild",labelOf:"von",labelResize:"Original verkleinert auf"},window.LightboxOptions||{});var Lightbox=Class.create();Lightbox.prototype={imageArray:[],activeImage:undefined,executionTimer:undefined,initialize:function(){this.updateImageList();this.keyboardAction=this.keyboardAction.bindAsEventListener(this);if(LightboxOptions.resizeSpeed>10){LightboxOptions.resizeSpeed=10}if(LightboxOptions.resizeSpeed<1){LightboxOptions.resizeSpeed=1}this.resizeDuration=LightboxOptions.animate?((11-LightboxOptions.resizeSpeed)*0.15):0;this.overlayDuration=LightboxOptions.animate?0.2:0;var b=(LightboxOptions.animate?250:1)+"px";var a=$$("body")[0];a.appendChild(Builder.node("div",{id:"overlay"}));a.appendChild(Builder.node("div",{id:"lightbox"},[Builder.node("div",{id:"outerImageContainer"},Builder.node("div",{id:"imageContainer"},[Builder.node("img",{id:"lightboxImage"}),Builder.node("div",{id:"hoverNav"},[Builder.node("a",{id:"prevLink",href:"#"}),Builder.node("a",{id:"nextLink",href:"#"})]),Builder.node("div",{id:"loading"},Builder.node("a",{id:"loadingLink",href:"#"},Builder.node("img",{src:LightboxOptions.fileBase+LightboxOptions.fileLoadingImage})))])),Builder.node("div",{id:"imageDataContainer"},Builder.node("div",{id:"imageData"},[Builder.node("div",{id:"imageDetails"},[Builder.node("span",{id:"caption"}),Builder.node("span",{id:"numberDisplay"})]),Builder.node("div",{id:"bottomNav"},Builder.node("a",{id:"bottomNavClose",href:"#"},Builder.node("img",{src:LightboxOptions.fileBase+LightboxOptions.fileBottomNavCloseImage,alt:"schließen",title:"schließen"})))]))]));$("overlay").hide().observe("click",(function(){this.end()}).bind(this));$("lightbox").hide().observe("click",(function(d){if(d.element().id=="lightbox"){this.end()}}).bind(this));$("outerImageContainer").setStyle({width:b,height:b});$("prevLink").observe("click",(function(d){d.stop();this.changeImage2(this.activeImage,"prev")}).bindAsEventListener(this));$("nextLink").observe("click",(function(d){d.stop();this.changeImage2(this.activeImage,"next")}).bindAsEventListener(this));$("loadingLink").observe("click",(function(d){d.stop();this.resetLightBox();this.end()}).bind(this));$("bottomNavClose").observe("click",(function(d){d.stop();this.resetLightBox();this.end()}).bind(this));if(LightboxOptions.imageScroll==true){Event.observe(window,"scroll",(function(d){this.onScrollEnd()}).bind(this))}var c=this;(function(){var d="overlay lightbox outerImageContainer imageContainer lightboxImage hoverNav prevLink nextLink loading loadingLink imageDataContainer imageData imageDetails caption numberDisplay bottomNav bottomNavClose";$w(d).each(function(e){c[e]=$(e)})}).defer()},updateImageList:function(){this.updateImageList=Prototype.emptyFunction;document.observe("click",(function(b){if(Event.isLeftClick(b)){var a=b.findElement("a[class^=ibk_lightbox]");if(a){b.stop();this.start(a)}}}).bind(this))},start:function(g){$$("select","object","embed").each(function(h){h.style.visibility="hidden"});var c=this.getPageSize("page");$("overlay").setStyle({width:c[0]+"px",height:c[1]+"px"});new Effect.Appear(this.overlay,{duration:this.overlayDuration,from:0,to:LightboxOptions.overlayOpacity});this.imageArray=[];var b=0;if((g.hasClassName("ibk_lightbox"))){var d=(g.up(0).next("div",0).innerHTML);this.imageArray.push([g.href,d])}var a=document.viewport.getScrollOffsets();var f=a[1]+LightboxOptions.tbDistance;var e=a[0];this.lightbox.setStyle({top:f+"px",left:e+"px"}).show();this.changeImage(b)},changeImage:function(b){this.activeImage=b;if(LightboxOptions.animate){this.loading.show()}this.lightboxImage.hide();this.hoverNav.hide();this.prevLink.hide();this.nextLink.hide();this.imageDataContainer.setStyle({opacity:0.0001});this.numberDisplay.hide();var a=new Image();a.onload=(function(){this.lightboxImage.src=this._cleanURI(this.imageArray[this.activeImage][0]);this.resizeImageContainer(a.width,a.height)}).bind(this);a.src=this._cleanURI(this.imageArray[this.activeImage][0])},resizeImageContainer:function(h,n){var k;var e;var p=this.outerImageContainer.getWidth();var o=this.outerImageContainer.getHeight();var g=(h+LightboxOptions.borderSize*2);var d=(n+LightboxOptions.borderSize*2);if(LightboxOptions.imageResize==true){var b=this.getPageSize("viewport");var m=b[0]-2*LightboxOptions.rlDistance;var j=b[1]-2*LightboxOptions.tbDistance-LightboxOptions.imageDataContainerHeight;var i=this.getResizeQuotient(g,d,m,j);g=Math.floor(g*i);d=Math.floor(d*i);h=g-LightboxOptions.borderSize*2;n=d-LightboxOptions.borderSize*2;if(LightboxOptions.showResizeFactor==true){if(i<1){var l=Math.round(i*100);this.imageArray[this.activeImage][1]+=" ("+LightboxOptions.labelResize+" "+l+"%)"}}}var r=(g/p)*100;var a=(d/o)*100;var c=p-g;var q=o-d;if(q!=0){new Effect.Scale(this.outerImageContainer,a,{scaleX:false,duration:this.resizeDuration,queue:"front"})}if(c!=0){new Effect.Scale(this.outerImageContainer,r,{scaleY:false,duration:this.resizeDuration,delay:this.resizeDuration})}var f=0;if((q==0)&&(c==0)){f=100;if(Prototype.Browser.IE){f=250}}(function(){this.prevLink.setStyle({height:n+"px"});this.nextLink.setStyle({height:n+"px"});this.nextLink.setStyle({maxHeight:n+"px"});this.imageDataContainer.setStyle({width:g+"px"});this.lightboxImage.setStyle({width:h+"px"});this.lightboxImage.setStyle({height:n+"px"});this.showImage()}).bind(this).delay(f/1000)},showImage:function(){this.loading.hide();new Effect.Appear(this.lightboxImage,{duration:this.resizeDuration,queue:"end",afterFinish:(function(){this.updateDetails()}).bind(this)});this.preloadNeighborImages()},updateDetails:function(){if(this.imageArray[this.activeImage][1]!=""){this.caption.update(this.imageArray[this.activeImage][1]).show()}if(this.imageArray.length>1){this.numberDisplay.update(LightboxOptions.labelImage+" "+(this.activeImage+1)+" "+LightboxOptions.labelOf+"  "+this.imageArray.length).show()}new Effect.Parallel([new Effect.SlideDown(this.imageDataContainer,{sync:true,duration:this.resizeDuration,from:0,to:1}),new Effect.Appear(this.imageDataContainer,{sync:true,duration:this.resizeDuration})],{duration:this.resizeDuration,afterFinish:(function(){var a=this.getPageSize("page");this.overlay.setStyle({height:a[1]+"px"});this.updateNav()}).bind(this)})},updateNav:function(){if(LightboxOptions.activateHoverNav==true){this.hoverNav.show()}if((this.activeImage>0&&LightboxOptions.circulateImages==false)||LightboxOptions.circulateImages==true){this.prevLink.show()}if((this.activeImage<(this.imageArray.length-1)&&LightboxOptions.circulateImages==false)||LightboxOptions.circulateImages==true){this.nextLink.show()}this.enableKeyboardNav()},enableKeyboardNav:function(){document.observe("keydown",this.keyboardAction)},disableKeyboardNav:function(){document.stopObserving("keydown",this.keyboardAction)},keyboardAction:function(d){var a=d.keyCode;var b;if(d.DOM_VK_ESCAPE){b=d.DOM_VK_ESCAPE}else{b=27}var c=String.fromCharCode(a).toLowerCase();if(c.match(/x|o|c/)||(a==b)){this.end()}else{if((c=="p")||(a==37)){if((this.activeImage!=0&&LightboxOptions.circulateImages==false)||LightboxOptions.circulateImages==true){this.disableKeyboardNav();this.changeImage2(this.activeImage,"prev")}}else{if((c=="n")||(a==39)){if((this.activeImage!=(this.imageArray.length-1)&&LightboxOptions.circulateImages==false)||LightboxOptions.circulateImages==true){this.disableKeyboardNav();this.changeImage2(this.activeImage,"next")}}}}},preloadNeighborImages:function(){var a,b;a=new Image();b=new Image();if(this.imageArray.length>this.activeImage+1){a.src=this._cleanURI(this.imageArray[this.activeImage+1][0])}else{a.src=this._cleanURI(this.imageArray[0][0])}if(this.activeImage>0){b.src=this._cleanURI(this.imageArray[this.activeImage-1][0])}else{b.src=this._cleanURI(this.imageArray[this.imageArray.length-1][0])}},end:function(){this.disableKeyboardNav();this.lightbox.hide();new Effect.Fade(this.overlay,{duration:this.overlayDuration});$$("select","object","embed").each(function(a){a.style.visibility="visible"})},getPageSize:function(d){var c,a;if(window.innerHeight&&window.scrollMaxY){c=window.innerWidth+window.scrollMaxX;a=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){c=document.body.scrollWidth;a=document.body.scrollHeight}else{c=document.body.offsetWidth;a=document.body.offsetHeight}}var b,e;if(self.innerHeight){if(document.documentElement.clientWidth){b=document.documentElement.clientWidth}else{b=self.innerWidth}e=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){b=document.documentElement.clientWidth;e=document.documentElement.clientHeight}else{if(document.body){b=document.body.clientWidth;e=document.body.clientHeight}}}if(a<e){pageHeight=e}else{pageHeight=a}if(c<b){pageWidth=c}else{pageWidth=b}if(d=="viewport"){return[b,e]}else{if(d=="page"){return[pageWidth,pageHeight]}else{if(d=="all"){return[pageWidth,pageHeight,b,e]}}}},getResizeQuotient:function(c,f,i,e){var a=i/e;var d;if(c>i||f>e){var g=c/f;if(g<a){nh=e;nb=g*e;d=nh/f}else{nb=i;nh=i/g;d=1;d=nb/c}}else{nb=c;nh=f;d=1}return d},resetLightBox:function(){$("outerImageContainer").setStyle({width:250,height:250})},_cleanURI:function(e){var d=/^([a-z]*:\/\/)/;var b=e.match(d);var a=b[0];var c=e.replace(a,"");var g=unescape(c);var f=a+escape(g);return f},onScrollEnd:function(){if(this.executionTimer){clearTimeout(this.executionTimer)}this.executionTimer=setTimeout(function(){if($("lightbox").visible){var a=document.viewport.getScrollOffsets();if(LightboxOptions.imageScrollVertical==true){var c=a[1]+LightboxOptions.tbDistance}else{var c=LightboxOptions.tbDistance}if(LightboxOptions.imageScrollHoricontal==true){var b=a[0]}else{var b=0}new Effect.Move("lightbox",{x:b,y:c,duration:0.5,mode:"absolute"})}},LightboxOptions.imageScrollDelay)},changeImage2:function(b,a){var d;var c=this.imageArray.length;if(a=="prev"){if(b==0){d=c-1}else{d=b-1}}if(a=="next"){if(b==c-1){d=0}else{d=b+1}}this.changeImage(d)}};document.observe("dom:loaded",function(){new Lightbox()});